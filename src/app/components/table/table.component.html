<div class="custom-table-card">
  <div class="table-title-bar" *ngIf="hasTableTitle">
    <ion-text>
      <h3>{{ tableTitle }}</h3>
    </ion-text>
  </div>

  <div class="table-card">
    <div class="table-responsive-wrapper">
      <table>
        <thead>
          <tr>
            <th *ngIf="showBilangan" class="col-bil ion-text-center">No.</th>
            <th *ngFor="let header of tableHeader" [style.text-align]="header.align || 'left'">
              {{ header.label }}
            </th>
          </tr>
        </thead>

        <tbody>
          <ng-container *ngIf="isLoading">
            <tr>
              <td class="loading-state" [attr.colspan]="tableHeader.length + (showBilangan ? 1 : 0)">
                <div class="loading-content">
                  <ion-spinner name="crescent"></ion-spinner>
                  <ion-text>
                    <p>Sedang Memuat...</p>
                  </ion-text>
                </div>
              </td>
            </tr>
          </ng-container>

          <ng-container *ngIf="!isLoading">
            <tr *ngIf="tableData.length === 0">
              <td class="empty-state" [attr.colspan]="tableHeader.length + (showBilangan ? 1 : 0)">
                <div class="empty-content">
                  <ion-icon name="search-outline"></ion-icon>
                  <ion-text>
                    <p>Tiada rekod dijumpai</p>
                  </ion-text>
                </div>
              </td>
            </tr>

            <tr *ngFor="let item of tableData; let i = index">
              <td *ngIf="showBilangan" class="col-bil ion-text-center">
                {{ (tablePaging.currentPage - 1) * tablePaging.record + i + 1 }}
              </td>

              <ng-container *ngFor="let header of tableHeader">
                <td [ngSwitch]="header.type" [style.text-align]="header.align || 'left'"
                  [ngClass]="header?.class || ''">

                  <span *ngSwitchCase="'display'" class="text-truncate" [title]="item[header.dataParam]">
                    {{ item[header.dataParam] || '-' }}
                  </span>

                  <ion-text *ngSwitchCase="'date'" color="dark">
                    {{ item[header.dataParam] | date:'dd MMM yyyy' }}
                  </ion-text>

                  <ion-text *ngSwitchCase="'datetime'" color="dark">
                    {{ item[header.dataParam] | date:'dd MMM yyyy, h:mm a' }}
                  </ion-text>

                  <ion-text *ngSwitchCase="'currency'" class="font-mono">
                    {{ item[header.dataParam] | currency:'RM ' }}
                  </ion-text>

                  <div *ngSwitchCase="'badge'" class="status-pill"
                    [style.background]="getBadgeColor(item[header.dataParam])">
                    {{ badgeText }}
                  </div>

                  <ion-checkbox *ngSwitchCase="'checkbox'" [checked]="item[header.dataParam]"
                    (ionChange)="onCheckboxChange($event.detail.checked, item, header.dataParam)">
                  </ion-checkbox>

                  <ion-radio-group *ngSwitchCase="'radio'" [value]="selectedRadio"
                    (ionChange)="onRadioSelect($event.detail.value)">
                    <ion-radio [value]="item"></ion-radio>
                  </ion-radio-group>

                  <ion-button *ngSwitchCase="'buttons'" size="small" fill="solid" [color]="header?.color || 'primary'"
                    class="ion-no-margin" (click)="onClickBtn(item)">
                    {{ header?.btnLabel }}
                  </ion-button>

                  <div *ngSwitchCase="'buttons-action'" class="actions-cell">
                    <ion-button fill="clear" size="small" color="dark" (click)="onEdit(item)">
                      <ion-icon slot="icon-only" name="pencil-outline" style="font-size: 18px;"></ion-icon>
                    </ion-button>

                    <ion-button fill="clear" size="small" color="danger" (click)="onDelete(item)">
                      <ion-icon slot="icon-only" name="trash-bin-outline" style="font-size: 18px;"></ion-icon>
                    </ion-button>
                  </div>
                </td>
              </ng-container>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>

    <div class="table-footer" *ngIf="showPaging">
      <div class="pagination-info">
        <ion-select [value]="tablePaging.record" interface="popover" (ionChange)="onRecordChange($event.detail.value)">
          <ion-select-option *ngFor="let option of recordOptions" [value]="option">
            {{ option }}
          </ion-select-option>
        </ion-select>
      </div>

      <div class="pagination-actions">
        <ion-button fill="clear" size="small" [disabled]="tablePaging.currentPage === 1" (click)="changePage(1)">
          <ion-icon slot="icon-only" name="play-skip-back"></ion-icon>
        </ion-button>

        <ion-button fill="clear" size="small" [disabled]="tablePaging.currentPage === 1"
          (click)="changePage(tablePaging.currentPage - 1)">
          <ion-icon slot="icon-only" name="chevron-back-outline"></ion-icon>
        </ion-button>

        <div class="page-number active">
          {{ tablePaging.currentPage }}
        </div>

        <ion-button fill="clear" size="small"
          [disabled]="tablePaging.currentPage === tablePaging.totalPages || tablePaging.totalPages == 0"
          (click)="changePage(tablePaging.currentPage + 1)">
          <ion-icon slot="icon-only" name="chevron-forward-outline"></ion-icon>
        </ion-button>

        <ion-button fill="clear" size="small"
          [disabled]="tablePaging.currentPage === tablePaging.totalPages || tablePaging.totalPages == 0"
          (click)="changePage(tablePaging.totalPages)">
          <ion-icon slot="icon-only" name="play-skip-forward"></ion-icon>
        </ion-button>
      </div>
    </div>
  </div>
</div>